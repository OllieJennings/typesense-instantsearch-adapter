{"version":3,"file":"TypesenseInstantsearchAdapter.js","names":["_interopRequireDefault","require","Object","defineProperty","exports","value","_regenerator","_objectWithoutProperties2","_defineProperty2","_asyncToGenerator2","_classCallCheck2","_createClass2","_Configuration","_typesense","_SearchRequestAdapter","_SearchResponseAdapter","_FacetSearchResponseAdapter","_excluded","ownKeys","e","r","t","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","TypesenseInstantsearchAdapter","options","_this","updateConfiguration","searchClient","clearCache","search","instantsearchRequests","searchTypesenseAndAdapt","searchForFacetValues","searchTypesenseForFacetValuesAndAdapt","key","_searchTypesenseAndAdapt","mark","_callee","_this2","typesenseResponse","adaptedResponses","wrap","_callee$","_context","prev","next","_adaptAndPerformTypesenseRequest","sent","results","map","typesenseResult","index","_validateTypesenseResult","responseAdapter","SearchResponseAdapter","configuration","adaptedResponse","adapt","_ref","abrupt","t0","console","error","stop","_x","_searchTypesenseForFacetValuesAndAdapt","_callee2","_this3","_callee2$","_context2","FacetSearchResponseAdapter","_x2","_adaptAndPerformTypesenseRequest2","_callee3","requestAdapter","_callee3$","_context3","SearchRequestAdapter","typesenseClient","request","_x3","TypesenseSearchClient","server","Configuration","validate","Error","concat","code","hits","grouped_hits"],"sources":["../src/TypesenseInstantsearchAdapter.js"],"sourcesContent":["\"use strict\";\n\nimport { Configuration } from \"./Configuration\";\nimport { SearchClient as TypesenseSearchClient } from \"typesense\";\nimport { SearchRequestAdapter } from \"./SearchRequestAdapter\";\nimport { SearchResponseAdapter } from \"./SearchResponseAdapter\";\nimport { FacetSearchResponseAdapter } from \"./FacetSearchResponseAdapter\";\n\nexport default class TypesenseInstantsearchAdapter {\n  constructor(options) {\n    this.updateConfiguration(options);\n    this.searchClient = {\n      clearCache: () => this.clearCache(),\n      search: (instantsearchRequests) => this.searchTypesenseAndAdapt(instantsearchRequests),\n      searchForFacetValues: (instantsearchRequests) =>\n        this.searchTypesenseForFacetValuesAndAdapt(instantsearchRequests),\n    };\n  }\n\n  async searchTypesenseAndAdapt(instantsearchRequests) {\n    let typesenseResponse;\n    try {\n      typesenseResponse = await this._adaptAndPerformTypesenseRequest(instantsearchRequests);\n\n      const adaptedResponses = typesenseResponse.results.map((typesenseResult, index) => {\n        this._validateTypesenseResult(typesenseResult);\n        const responseAdapter = new SearchResponseAdapter(\n          typesenseResult,\n          instantsearchRequests[index],\n          this.configuration,\n          typesenseResponse.results,\n        );\n        let adaptedResponse = {\n          ...responseAdapter.adapt(),\n          // eslint-disable-next-line no-unused-vars\n          ...(({ results, ...o }) => o)(typesenseResponse), // All other keys in the response (like `conversation`)\n        };\n\n        return adaptedResponse;\n      });\n\n      return {\n        results: adaptedResponses,\n      };\n    } catch (error) {\n      console.error(error);\n      throw error;\n    }\n  }\n\n  async searchTypesenseForFacetValuesAndAdapt(instantsearchRequests) {\n    let typesenseResponse;\n    try {\n      typesenseResponse = await this._adaptAndPerformTypesenseRequest(instantsearchRequests);\n\n      const adaptedResponses = typesenseResponse.results.map((typesenseResult, index) => {\n        this._validateTypesenseResult(typesenseResult);\n        const responseAdapter = new FacetSearchResponseAdapter(\n          typesenseResult,\n          instantsearchRequests[index],\n          this.configuration,\n        );\n        return responseAdapter.adapt();\n      });\n\n      return adaptedResponses;\n    } catch (error) {\n      console.error(error);\n      throw error;\n    }\n  }\n\n  async _adaptAndPerformTypesenseRequest(instantsearchRequests) {\n    const requestAdapter = new SearchRequestAdapter(instantsearchRequests, this.typesenseClient, this.configuration);\n    const typesenseResponse = await requestAdapter.request();\n    return typesenseResponse;\n  }\n\n  clearCache() {\n    this.typesenseClient = new TypesenseSearchClient(this.configuration.server);\n    return this.searchClient;\n  }\n\n  updateConfiguration(options) {\n    this.configuration = new Configuration(options);\n    this.configuration.validate();\n    this.typesenseClient = new TypesenseSearchClient(this.configuration.server);\n    return true;\n  }\n\n  _validateTypesenseResult(typesenseResult) {\n    if (typesenseResult.error) {\n      throw new Error(`${typesenseResult.code} - ${typesenseResult.error}`);\n    }\n    if (!typesenseResult.hits && !typesenseResult.grouped_hits) {\n      throw new Error(`Did not find any hits. ${typesenseResult.code} - ${typesenseResult.error}`);\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}